#!/usr/bin/env bash

function master() {
  # git pull origin master
  git checkout master
}
function stage() {
  git checkout stage
}

function version() {
  local __version=$1
  local version=`node -pe 'JSON.parse(process.argv[1]).version' "$(cat bower.json)"`
  eval $__version="'$version'"
}
function headHash() {
  local __hash=$1
  local gitHash=`git rev-parse --short HEAD`
  eval $__hash="'$gitHash'"
}

if [[ "${TRAVIS_PULL_REQUEST}" == "false" ]] && [[ "${TRAVIS_BRANCH}" == "stage" ]]; then
  echo "Updating stage branch and marging with master..."

  getMasterData version gitHash
  echo "Element version $version, hash: $gitHash"
  # ./node_modules/.bin/arc stage
  exit
fi

if [[ "${TRAVIS_PULL_REQUEST}" == "false" ]] && [[ "${TRAVIS_BRANCH}" == "master" ]]; then
  echo "Deploying release to master branch..."
  exit
fi

master
version elementVersion
headHash masterHash
stage

echo ""
echo "Element version"
echo $elementVersion
echo "hash: "
echo $masterHash
