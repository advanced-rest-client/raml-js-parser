#!/usr/bin/env bash

function getMasterData() {
  local __version=$1
  local __hash=$2

  git pull origin master
  git checkout master

  local version=`node -pe 'JSON.parse(process.argv[1]).version' "$(cat bower.json)"`
  local gitHash=`git rev-parse --short HEAD`

  git checkout stage

  eval $__version="'$version'"
  eval $__hash="'$gitHash'"
}

if [[ "${TRAVIS_PULL_REQUEST}" == "false" ]] && [[ "${TRAVIS_BRANCH}" == "stage" ]]; then
  echo "Updating stage branch and marging with master..."

  getMasterData version gitHash
  echo "Element version $version, hash: $gitHash"
  # ./node_modules/.bin/arc stage
  exit
fi

if [[ "${TRAVIS_PULL_REQUEST}" == "false" ]] && [[ "${TRAVIS_BRANCH}" == "master" ]]; then
  echo "Deploying release to master branch..."
  exit
fi

getMasterData version gitHash
echo ""
echo "Element version"
echo $version
echo "hash: "
echo $gitHash
